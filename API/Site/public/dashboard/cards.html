<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../css/imgs/logosem.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Souloxy | Perfil</title>

    <link rel="stylesheet" href="../css/formulários.css">
    <link rel="stylesheet" href="../css/perfil.css">
    <link rel="stylesheet" href="dashboards.css">

    <script src="../js/funcoes.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body onload="validarSessao()">

    <div class="header">
        <div class="container">

            <h1 class="titulo">SOULOXY</h1>

            <ul class="navBar">
                <li> <a href="../Quiz.html">Quiz</a></li>
                <li> <a href="../dashboard/Simuladores.html">Simuladores</a></li>
                <li>|</li>
                <li><a href="./dashboard.html">Gráficos</a></li>
                <li> <a onclick="limparSessao()" href="../index.html">Sair</a></li>
            </ul>
        </div>
    </div>

    <div class="fundo">
        <div class="janela">

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                <h3>Seu Identificador <span id="b_id">ID</span></h3>
                <h3>Seu Email <span id="b_email">ID</span></h3>
            </div>

            <div class="inserir">
                <li> <a href="Cadastroviagens.html">Cadastrar viagens</a></li>
            </div>

        </div>  
         <a href="cards copy.html">aaaaaaaaaaaaaaaa</a></li>

        <div class="dash">

            <div class="regua">
                <div class="item-regua maismeses">
                    <h4>Meses do ano que mais viajou</h4>
                    <h2>Julho e Agosto</h2>
                </div>
                <div class="item-regua menosmeses">
                    <h4>Meses do ano que menos viajou</h4>
                    <h2>Março e Abril</h2>
                </div>
                <div class="item-regua totalviagens">
                    <h4>Total de Viagens Realizadas: </h4>
                    <h2>12/14</h2>
                </div>
                <div class="item-regua maisvisitados">
                    <h4>Locais mais visitados:
                    </h4>
                    <h2>Cachoeira</h2>
                </div>

            </div>

            <div class="cards">
                <div class="card">
                    <h1>Gráfico Cidade </h1>
                    <div class="graph">
                        <canvas id="exibirCidadeUsuario">Gráfico Cidade</canvas>
                    </div>

                </div>

                <div class="card">
                    <h1>Gráfico Duração</h1>
                    <div class="graph">
                        <canvas id="exibirDuracaoUsuario">Gráfico Cidade</canvas>
                    </div>
                </div>

                <div class="card">
                    <h1>Gráfico Satisfação</h1>
                    <div class="satisfacao">
                        <p id="usuario3"></p>
                    </div>

                </div>

                <div class="card">
                    <h1>Gráfico Datas</h1>
                    <div class="data">
                        <p id="usuario4"></p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>

<script>

        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
        b_id.innerHTML = sessionStorage.ID;
        b_email.innerHTML = sessionStorage.EMAIL_USUARIO;        

        function atualizacaoPeriodica() {
            exibirCidadeUsuario(id);
            // obterdados(2);
            // obterdados(3);
            // obterdados(4);

            function sendData() {
                var http = new XMLHttpRequest();
                http.open('POST', 'http://localhost:3000/api/sendData', false);
                http.send(null);
            // }

            //  setInterval(() => {
            //  	sendData();
            //  }, 2000);
            //  setTimeout(atualizacaoPeriodica, 5000);
        }

        function exibirCidadeUsuario(id) {
            fetch(`/viagens/exibirCidadeUsuario`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    fkusuario: id
                })
            })
                .then(resposta => {
                    console.log(resposta)
                    if (resposta.ok) {

                        resposta.json().then(json => {
                            console.log(json);
                            console.log(JSON.stringify(json));

                            sessionStorage.EMAIL_USUARIO = json.email;
                            sessionStorage.SENHA_USUARIO = json.senha;
                            sessionStorage.NOME_USUARIO = json.nome;
                            sessionStorage.ID = json.id;

                            setTimeout(function () {
                                window.location = "./dashboard/cards.html";
                            }, 1000); // apenas para exibir o loading

                        });

                        resposta.json().then(resposta => {

                            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                            var dados = {
                                cidade: resposta[0].cidade,
                            }

                            alertar(resposta[0].cidade, idviagem);
                        });
                    } else {

                        console.error('Nenhum dado encontrado ou erro na API');
                    }
                })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
                });

        }

        // function alertar(cidade, idviagem) {
        //     var limites = {
        //         muito_quente: 23,
        //         quente: 22,
        //         ideal: 20,
        //         frio: 10,
        //         muito_frio: 5
        //     };

        //     var classe_temperatura = 'cor-alerta';

        //     if (temperatura >= limites.muito_quente) {
        //         classe_temperatura = 'cor-alerta perigo-quente';
        //         console.log("caiu no 1")
        //     }
        //     else if (temperatura < limites.muito_quente && temperatura >= limites.quente) {
        //         classe_temperatura = 'cor-alerta alerta-quente';
        //         console.log("caiu no 2")
        //     }
        //     else if (temperatura < limites.quente && temperatura > limites.frio) {
        //         classe_temperatura = 'cor-alerta ideal';
        //         console.log("caiu no 3")
        //     }
        //     else if (temperatura <= limites.frio && temperatura > limites.muito_frio) {
        //         classe_temperatura = 'cor-alerta alerta-frio';
        //         console.log("caiu no 4")
        //     }
        //     else if (temperatura < limites.min_temperatura) {
        //         classe_temperatura = 'cor-alerta perigo-frio';
        //         console.log("caiu no 5")
        //     }

        //     var card;

        //     if (idviagem == 1) {
        //         temp_aquario_1.innerHTML = temperatura + "°C";
        //         card = card_1
        //     } else if (idviagem == 2) {
        //         temp_aquario_2.innerHTML = temperatura + "°C";
        //         card = card_2
        //     } else if (idviagem == 3) {
        //         temp_aquario_3.innerHTML = temperatura + "°C";
        //         card = card_3
        //     } else if (idviagem == 4) {
        //         temp_aquario_4.innerHTML = temperatura + "°C";
        //         card = card_4
        //     }

        //     // alterando
        //     card.className = classe_temperatura;

        // }
    }
</script>

</html>